---
title: "Prevalence of _H. Pylori_ Infection by birth year"
subtitle: "A meta regression analysis"
author: "Chaochen Wang 王超辰"
date: "2017/7/14 in NCC"
output:
  xaringan::moon_reader:
    css: zh-CN.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: center, middle 

# METHODS
---

 
## Data sources and extraction

.pull-left[
+ **PubMed** and **Embase** were searched for studies reported prevalence of _H. pylori_ infection among Japanese population (until 30 June, 2016). 

+ 43 papers  <br>
   $+$ JPHC Cohort II <br> 
   $+$ JPHC-NEXT Cohort Study <br>
   included for meta-regression analysis [(Table 1)](http://rpubs.com/winterwang/288338).
+ Prevalence of _H. pylori_ infection reported by birth year group of participants<sup>[1~7]</sup>.  

]

.pull-right[

+ 38 studies reported prevalence with age groups. 
  - 34 studies reported data collection period: 
  
  - Example: <br>60-70 years old group; <br>data collection done in 1990;<br> birth year should be 1920~1930.
  
  - 4 studies reported age groups with data collection year unavailable, year of publication was used instead of data collection period.
]

.footnote[
[1] Ueda J. **_Helicobacter._** 2014; [2] Watanabe M. **_Cancer Sci._** 2015;<br>
[3] Reploge M.L. **_Int J Epidemiol._** 1996; [4] Shimoyama T. **_Gastric Cancer._** 2012;<br> [5] Shimatani T. **_J Gastroenterol Hepatol._** 2005; [6] JPHC Cohort II; [7] JPHC-NEXT
]
---
class: center, middle 

# STATISTICAL ANALYSIS

---

## 273 Data Points from 45 Studies were available for meta-regression

```{r eval=require('DT'), tidy=FALSE, echo=FALSE, warning=FALSE}
com_data <- read.csv("complete_data.csv")
datatable(
  com_data, rownames=FALSE,
  extensions = list(Scroller=NULL,  FixedColumns=list(leftColumns=2)),
  options = list(
    dom = 'T<"clear">lfrtip',
    columnDefs = list(list(width = '20%', targets = list(2,3,4))),
    deferRender=TRUE,
    scrollX=TRUE,scrollY=400,
    scrollCollapse=TRUE,
    pageLength = 100, lengthMenu = c(10,50,100,200,300)
  )
)
```

---

class: middle

## Step 1: Weight Calculation

```{r, eval=FALSE}
library(meta)

library(metafor)

library(mgcv)


meta <- metaprop( event = Number_of_Positive,
                  n     = Number_of_Subjects_in_the_corresponding_group,   
                  byvar = Birth_Year,
                  sm    = "PLOGIT",    # Logit transformation 
             method.tau = "REML")      # Restricted Maximum-likelihood
                                       # estimator to estimate the 
                                       # between-study variance 


weight<-meta$w.random # Weight of each data point extracted
```


---

### Step 2: Meta-regression (Generalized Additive Mixed Model, GAMM)

```{r, eval=FALSE}
########################   MODEL 1  ###############################
res1 <- gam(cbind(event,n) ~ s(Birth_Year, bs="cr") +
                                      # Cubic Spline Regression 三次スプライン曲線
              s(Study_ID, bs="re") +  # Study ID as random effect 
              Source_of_population +  # Community OR Clinical based 
              Specimen_type        +  # Serum OR Others (urinary, salivary, stool, biopsy)
              Kit.from             +  # Antigen derived from demostic or foreign
              early,                  # Data collection period, cutoff = 2000
              data = data, weights=weight, 
              family="binomial"(link=logit), method="REML")
########################   MODEL 2 ################################
res2 <- gam(cbind(event,n) ~ s(Birth_Year, bs="cr") +
              s(Study_ID, bs="re") +  
              Specimen_type,
              data = data, weights=weight, 
              family="binomial"(link=logit), method="REML")
########################   MODEL 3 ################################
res3 <- gam(cbind(event,n) ~ s(Birth_Year, bs="cr") +
              s(Study_ID, bs="re"),
              data = data, weights=weight, 
              family="binomial"(link=logit), method="REML")
```


---
class: middle

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#ccc;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;}
.tg .tg-ufcl{font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;text-align:center;vertical-align:top}
.tg .tg-h4th{background-color:#f9f9f9;font-weight:bold;font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;text-align:center;vertical-align:top}
.tg .tg-cihi{background-color:#f9f9f9;font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;text-align:center;vertical-align:top}
.tg .tg-8c1j{font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;vertical-align:top}
.tg .tg-jo60{font-weight:bold;font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;vertical-align:top}
.tg .tg-kyai{font-weight:bold;font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;text-align:center;vertical-align:top}
.tg .tg-6sx4{background-color:#f9f9f9;font-size:20px;font-family:Tahoma, Geneva, sans-serif !important;;vertical-align:top}
</style>
<table class="tg" align="center">
  <tr>
    <th class="tg-jo60" colspan="4">TABLE 2. Informations for tested models.</th>
  </tr>
  <tr>
    <td class="tg-8c1j"></td>
    <td class="tg-h4th">AIC</td>
    <td class="tg-kyai">BIC</td>
    <td class="tg-h4th">LogLik</td>
  </tr>
  <tr>
    <td class="tg-8c1j">Model 1: <br>Logit(P) = s(birth year) + r(study ID) + <br>                 f(source of population) + f(diagnostic test) + <br>                 f(ELIZA kits) + f(research year)</td>
    <td class="tg-cihi">1716.444</td>
    <td class="tg-ufcl">1895.216</td>
    <td class="tg-cihi">-808.6935 (df=49.53)</td>
  </tr>
  <tr>
    <td class="tg-8c1j">Model 2: <br>Logit(P) = s(birth year) + r(study ID) + <br>                 f(diagnostic test)</td>
    <td class="tg-cihi">1730.349</td>
    <td class="tg-ufcl">1904.178</td>
    <td class="tg-cihi">-817.0157 (df=48.16)</td>
  </tr>
  <tr>
    <td class="tg-8c1j">Model 3: <br>Logit(P) = s(birth year) + r(study ID)</td>
    <td class="tg-cihi">1731.451</td>
    <td class="tg-ufcl">1906.366</td>
    <td class="tg-cihi">-817.2658 (df=48.46)</td>
  </tr>
  <tr>
    <td class="tg-8c1j">Abbreviations and definitions: <br>AIC: Akaike’s information criterion; <br>BIC: Bayesian information criterion; <br>LogLik: Log-likelihood;<br>P: prevalence; <br>s: penalized cubic spline; <br>r: random effect; <br>f: fixed effect; <br>df: degree of freedom.</td>
    <td class="tg-6sx4"></td>
    <td class="tg-8c1j"></td>
    <td class="tg-6sx4"></td>
  </tr>
</table>

---

### Summary from Model 1 comparable to [Table 3](http://rpubs.com/winterwang/table3)
```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(meta)
library(metafor)
library(mgcv)
library(epicalc)

com_data <- read.csv("complete_data.csv")
com_data$kit.from <- as.character(com_data$kit.from)
com_data$kit.from[is.na(com_data$kit.from)] <- "unknown"
com_data$kit.from[com_data$kit.from=="domestic "] <- "domestic"
com_data$kit.from <- as.factor(com_data$kit.from)
#table(com_data$kit.from)
com_data$kit.from <- relevel(com_data$kit.from, ref = "domestic")

com_data <- na.omit(com_data)
com_data$mp=com_data$total*com_data$n_total
com_data$mp=round(com_data$mp)


x=as.character(com_data$Specimen.type)
x[x=="serum"]="serum"
x[x=="stool"]="other"
x[x=="serum/stool"]="other"
x[x=="biopsy"]="other"
x[x=="saliva"]="other"
x[x=="urine"]="other"
com_data$Specimen.type=factor(x)
com_data$Specimen.type <- relevel(com_data$Specimen.type, ref = "serum")
use(com_data)
meta <- metaprop(event=mp,n=n_total,byvar=birth.year_high,sm="PLOGIT",method.tau="REML")
com_data$wt<-meta$w.random

com_data$early=ifelse(com_data$Research.Year<2000,"early","late")

com_data$No <- as.factor(com_data$No)
res0 <- gam(cbind(mp,n_total-mp) ~ s(birth.year_high,bs="cr")+ s(No,bs="re")+Source.population+Specimen.type+
              kit.from+early, 
            #+ adultdults.or.childhildren, 
            data = com_data, weights=wt, family="binomial"(link=logit), method="REML")
summary(res0)

```


---
